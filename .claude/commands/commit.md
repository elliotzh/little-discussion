请执行以下流程来提交修改过的文档：

## 前置步骤：Worktree 同步检查

如果当前目录是一个 git worktree（非主 worktree），执行以下同步：

1. 运行 `git worktree list` 确认当前处于 worktree 中
2. 运行 `git fetch origin` 获取最新远程状态
3. 运行 `git rebase main` 将当前分支变基到最新 main 上
4. 如果 rebase 产生冲突，提示用户处理后再继续

如果当前在主 worktree（main 分支）上，跳过此步骤。

## 第一步：识别修改的 .md 文件

运行 `git diff --name-only HEAD` 和 `git diff --name-only --cached HEAD` 以及 `git ls-files --others --exclude-standard`，找出所有已修改、已暂存或新增的 `.md` 文件。

**排除 `docs-todo/` 目录下的所有文件**——这些是审阅建议，不需要审阅。

如果没有任何 `.md` 文件被修改，告知用户并结束流程。

## 第二步：文档体系一致性检查

在逐文件审阅之前，先做一次全局一致性检查：

1. **目录树一致性**：列出 `docs/` 下所有实际存在的 `.md` 文件，与 CLAUDE.md「文档体系」中列出的文件逐一比对。报告：
   - CLAUDE.md 中列出但磁盘上不存在的文件
   - 磁盘上存在但 CLAUDE.md 中未注册的文件（新增文件需补充）
2. **跨文档引用行号验证**：对 CLAUDE.md「跨文档引用」中记录的每一条引用（含行号），读取对应文件的相关行，验证引用内容是否仍在该行。报告漂移的行号并给出当前正确行号。
3. **CLAUDE.md 自身修改检查**：如果 CLAUDE.md 在本次修改文件中，额外检查其术语表、文档体系树、跨文档引用等各部分的内部自洽性。

如发现不一致，在汇总阶段单独列出。

## 第三步：逐一审阅

对每个修改过的 `.md` 文件（`docs-todo/` 除外），执行 `/review-doc` 审阅流程：
- 先检查同目录下是否存在对应的 `.meta.json` 文件，如有则读取作为审阅上下文
- 按 review-doc 的全部审阅维度进行审阅（包括文档体系一致性维度）
- 同时检查 CLAUDE.md 中的术语一致性规则和信息隔离规则
- 读取 `docs-todo/` 下对应的已有审阅建议作为参考

如果存在多个文件，使用并行的 subagent 同时审阅以提高效率。

## 第四步：汇总审阅结果

将一致性检查和所有文件的审阅结果汇总呈现给用户，格式如下：

### 📋 文档体系一致性

- 目录树：✅ 一致 / ⚠️ 存在差异（列出）
- 跨文档引用行号：✅ 准确 / ⚠️ 存在漂移（列出旧行号 → 新行号）
- CLAUDE.md 自洽性：✅ 正常 / ⚠️ 存在问题（列出）

### 📋 文件审阅汇总

**[文件路径]**
- 总体评价：...
- 需改进项（如有）：...

（每个文件一个小节）

## 第五步：请求确认并循环处理

向用户展示审阅结果后，使用 AskUserQuestion 询问用户：
- 选项 1：直接提交（审阅无重大问题时推荐）
- 选项 2：先修复审阅问题再提交
- 选项 3：取消提交

### 选项 2 的循环处理流程

如果用户选择"先修复审阅问题再提交"，执行以下循环：

1. **暂存当前改动**：先 `git add` 所有当前修改的文件（包括 `.md` 文件和 `docs-todo/` 下的文件），使用户可以通过 `git diff` 查看后续自动修复产生的增量改动
2. **执行修复**：根据审阅发现的问题，自动修复文档
3. **更新审阅建议**：修复完成后，更新或删除对应的 `docs-todo/` 文件（如所有问题已解决则删除）
4. **回到第四步**：重新汇总审阅结果并展示给用户，用户可以：
   - 通过 `git diff` 查看自动修复产生的改动
   - 再次选择"直接提交"、"自动修复后提交"或"取消提交"

这个循环确保用户始终可以审查自动修复的内容，并在满意后再提交。

## 第六步：执行提交并同步到 main

如果用户选择直接提交：

1. **提交**：将所有修改的文件加入暂存区（包括 `.md` 文件和 `docs-todo/` 下被更新/删除的文件），根据修改内容生成合适的 commit message，执行提交
2. **同步到 main**（worktree 场景下必须执行，不可跳过）：
   - 运行 `git worktree list` 判断是否处于 worktree 中；如果当前在主 worktree（main 分支）上，跳过同步
   - 获取主 worktree 路径，运行 `git -C <主worktree路径> merge <当前分支名>`
   - 合并成功：告知用户已同步到 main，运行 `git reset --hard main` 将当前分支重置到 main，使工作空间立即可用于下一个任务
   - 合并冲突：告知用户需要手动处理，给出具体命令；不执行重置
